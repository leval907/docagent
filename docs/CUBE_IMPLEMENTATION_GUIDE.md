# üöÄ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é Cube.js –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
## –°–∏—Å—Ç–µ–º–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–∏–∫ –Ω–∞ –±–∞–∑–µ —Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ –ü–ª–∞–Ω–∞ —Å—á–µ—Ç–æ–≤

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä —Ä–µ—à–µ–Ω–∏—è](#–æ–±–∑–æ—Ä-—Ä–µ—à–µ–Ω–∏—è)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–∏—Å—Ç–µ–º—ã)
3. [–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥–∏–∫–∏](#—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ-–º–µ—Ç–æ–¥–∏–∫–∏)
4. [–ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è](#–ø–ª–∞–Ω-–≤–Ω–µ–¥—Ä–µ–Ω–∏—è)
5. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AI-–∞–≥–µ–Ω—Ç–∞–º–∏](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-—Å-ai-–∞–≥–µ–Ω—Ç–∞–º–∏)
6. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å DataLens](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-—Å-datalens)
7. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-–∏-–≤–∞–ª–∏–¥–∞—Ü–∏—è)
8. [–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ](#–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å-–∏-–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ)

---

## 1. –û–±–∑–æ—Ä —Ä–µ—à–µ–Ω–∏—è

### –ß—Ç–æ —Å–æ–∑–¥–∞–Ω–æ

–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –Ω–∞ –±–∞–∑–µ Cube.js, –≤–∫–ª—é—á–∞—é—â–∞—è:

‚úÖ **4 –æ—Å–Ω–æ–≤–Ω—ã—Ö Cube —Å—Ö–µ–º—ã:**
1. `Accounts` - –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Å—á–µ—Ç–æ–≤ (416 —Å—á–µ—Ç–æ–≤ —Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ –ü–ª–∞–Ω–∞ —Å—á–µ—Ç–æ–≤)
2. `TrialBalance` + `HorizontalAnalysis` - –û–°–í –∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
3. `FinancialRatios` - 20 —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤
4. `Consolidation` + `VerticalAnalysis` - –ö–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è –≥—Ä—É–ø–ø—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑

‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–æ—Å—Å–∏–π—Å–∫–æ–π —Å–ø–µ—Ü–∏—Ñ–∏–∫–∏:**
- –ê–∫—Ç–∏–≤–Ω—ã–µ/–ü–∞—Å—Å–∏–≤–Ω—ã–µ/–ê–∫—Ç–∏–≤–Ω–æ-–ø–∞—Å—Å–∏–≤–Ω—ã–µ —Å—á–µ—Ç–∞ (–ê/–ü/–ê–ü)
- –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (–¥–æ 3 —Å—É–±–∫–æ–Ω—Ç–æ)
- –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π –ü–ª–∞–Ω —Å—á–µ—Ç–æ–≤
- –ë–∞–ª–∞–Ω—Å–æ–≤—ã–µ –≥—Ä—É–ø–ø—ã –ø–æ –†–°–ë–£

‚úÖ **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥–∏–∫–∏ –∞–Ω–∞–ª–∏–∑–∞:**
- –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (–ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å, —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å, –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å)
- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (–¥–∏–Ω–∞–º–∏–∫–∞ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π)
- –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–ª–∞–Ω—Å–∞)
- –ö–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è —Å –º–µ–∂—Ñ–∏—Ä–º–µ–Ω–Ω—ã–º–∏ —ç–ª–∏–º–∏–Ω–∞—Ü–∏—è–º–∏

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ Cube

| –ê—Å–ø–µ–∫—Ç | –ë–µ–∑ Cube | –° Cube |
|--------|----------|--------|
| **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏** | 3+ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞–∂–¥–æ–π –º–µ—Ç–æ–¥–∏–∫–∏ | 1 —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è |
| **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª—ã** | –ü—Ä–∞–≤–∫–∞ –≤ 3+ –º–µ—Å—Ç–∞—Ö | –ü—Ä–∞–≤–∫–∞ –≤ 1 –º–µ—Å—Ç–µ |
| **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö** | –†–∏—Å–∫ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π | –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ |
| **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** | –†–∞–∑—Ä–æ–∑–Ω–µ–Ω–Ω–∞—è | –í—Å—Ç—Ä–æ–µ–Ω–∞ –≤ schema |
| **–í—Ä–µ–º—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–µ—Ç–æ–¥–∏–∫–∏** | 2-3 –¥–Ω—è | 0.5-1 –¥–µ–Ω—å |
| **–î–æ—Å—Ç—É–ø –¥–ª—è AI** | –°–ª–æ–∂–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | REST/SQL API |

**ROI:** –ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è 5+ –º–µ—Ç–æ–¥–∏–∫ —ç–∫–æ–Ω–æ–º–∏—è —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç ~200 —á–∞—Å–æ–≤/–≥–æ–¥ –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É.

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –û–±—â–∞—è —Å—Ö–µ–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   DATA SOURCES                          ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  PostgreSQL          DuckDB           ArangoDB          ‚îÇ
‚îÇ  (persistence)       (OLAP)           (graph)           ‚îÇ
‚îÇ  - trial_balance     - ad-hoc queries - eliminations    ‚îÇ
‚îÇ  - accounts          - analytics      - hierarchies     ‚îÇ
‚îÇ  - companies                                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
             ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   CUBE.JS LAYER                         ‚îÇ
‚îÇ              (Semantic + Methods)                       ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  CUBES (–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–¥–µ–ª–∏)                    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Accounts (—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Å—á–µ—Ç–æ–≤)                  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ TrialBalance (–û–°–í)                            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ HorizontalAnalysis (–¥–∏–Ω–∞–º–∏–∫–∞)                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ FinancialRatios (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã)                ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Consolidation (–∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è)                  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ VerticalAnalysis (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)                  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                   ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  FEATURES                                         ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Pre-aggregations (–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)                ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Access Control (row-level security)           ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ API Gateway (REST/SQL/GraphQL)                ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                   ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ
              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   CONSUMERS                             ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  DataLens          AI Agents        Excel Export        ‚îÇ
‚îÇ  (–¥–∞—à–±–æ—Ä–¥—ã)        (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞)     (—Ä–µ–≥–ª–∞–º–µ–Ω—Ç—ã)        ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  - SQL API         - REST API       - REST API          ‚îÇ
‚îÇ  - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è    - LangChain      - Python scripts    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –í—ã–±–æ—Ä —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

**–ü–æ—á–µ–º—É Cube.js –æ–ø—Ç–∏–º–∞–ª–µ–Ω –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–∏–∫:**

1. **–î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏**
   - –§–æ—Ä–º—É–ª—ã –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –≤ YAML
   - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤—Å—Ç—Ä–æ–µ–Ω–∞ –≤ –∫–æ–¥
   - Git-–≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

2. **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø**
   - DataLens –≤–∏–¥–∏—Ç —Ç–µ –∂–µ –º–µ—Ç—Ä–∏–∫–∏, —á—Ç–æ –∏ AI
   - –û–¥–Ω–∞ —Ç–æ—á–∫–∞ –ø—Ä–∞–≤–¥—ã –¥–ª—è –≤—Å–µ—Ö –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π

3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
   - Pre-aggregations –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   - Incremental refresh

4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
   - Row-level security
   - Column-level permissions
   - –ó–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π

---

## 3. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥–∏–∫–∏

### 3.1. –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (20 –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤)

**–§–∞–π–ª:** `cube_schema_financial_ratios.yml`

#### –ì—Ä—É–ø–ø—ã –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤:

**A. –õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å (3 –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞)**
1. `currentRatio` - –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ç–µ–∫—É—â–µ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
2. `quickRatio` - –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –±—ã—Å—Ç—Ä–æ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
3. `cashRatio` - –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∞–±—Å–æ–ª—é—Ç–Ω–æ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏

**B. –†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å (4 –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞)**
4. `roa` - Return on Assets (—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –∞–∫—Ç–∏–≤–æ–≤)
5. `roe` - Return on Equity (—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –∫–∞–ø–∏—Ç–∞–ª–∞)
6. `ros` - Return on Sales (—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–¥–∞–∂)
7. `grossMargin` - –í–∞–ª–æ–≤–∞—è —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å

**C. –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å (8 –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤)**
8. `arTurnover` - –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å –î–ó
9. `dso` - –ü–µ—Ä–∏–æ–¥ –æ–±–æ—Ä–æ—Ç–∞ –î–ó (–¥–Ω–∏)
10. `inventoryTurnover` - –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å –∑–∞–ø–∞—Å–æ–≤
11. `daysInventoryOutstanding` - –ü–µ—Ä–∏–æ–¥ –æ–±–æ—Ä–æ—Ç–∞ –∑–∞–ø–∞—Å–æ–≤ (–¥–Ω–∏)
12. `apTurnover` - –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å –ö–ó
13. `dpo` - –ü–µ—Ä–∏–æ–¥ –æ–±–æ—Ä–æ—Ç–∞ –ö–ó (–¥–Ω–∏)
14. `operatingCycle` - –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ü–∏–∫–ª
15. `cashConversionCycle` - –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ü–∏–∫–ª (CCC)

**D. –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å (4 –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞)**
16. `equityRatio` - –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∞–≤—Ç–æ–Ω–æ–º–∏–∏
17. `debtToEquity` - –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ä—ã—á–∞–≥
18. `interestCoverage` - –ü–æ–∫—Ä—ã—Ç–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤
19. `debtRatio` - –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏

**E. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ (1 –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å)**
20. `workingCapital` - –ß–∏—Å—Ç—ã–π –æ–±–æ—Ä–æ—Ç–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª

#### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```yaml
# –ó–∞–ø—Ä–æ—Å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ Cube API
{
  "measures": [
    "FinancialRatios.currentRatio",
    "FinancialRatios.roe",
    "FinancialRatios.dso"
  ],
  "dimensions": [
    "FinancialRatios.companyName"
  ],
  "filters": [{
    "member": "FinancialRatios.periodDate",
    "operator": "equals",
    "values": ["2024-10-31"]
  }]
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "companyName": "–û–û–û '–ê–ª—å—Ñ–∞'",
  "currentRatio": 1.85,
  "roe": 12.3,
  "dso": 45.2
}
```

---

### 3.2. –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑

**–§–∞–π–ª:** `cube_schema_trial_balance.yml` (–∫—É–± HorizontalAnalysis)

**–ú–µ—Ç—Ä–∏–∫–∏:**
- `currentBalance` - –¢–µ–∫—É—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫
- `previousBalance` - –ü—Ä–µ–¥—ã–¥—É—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫
- `absoluteChange` - –ê–±—Å–æ–ª—é—Ç–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ (—Ä—É–±.)
- `percentChange` - –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ (%)
- `growthRate` - –¢–µ–º–ø —Ä–æ—Å—Ç–∞ (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç)
- `turnoverChange` - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ–±–æ—Ä–æ—Ç–æ–≤

**Segments –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:**
- `significantGrowth` - –†–æ—Å—Ç >20%
- `significantDecline` - –°–Ω–∏–∂–µ–Ω–∏–µ >20%
- `signChange` - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–Ω–∞–∫–∞ –æ—Å—Ç–∞—Ç–∫–∞

#### –ü—Ä–∏–º–µ—Ä: –ê–Ω–∞–ª–∏–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–µ–±–∏—Ç–æ—Ä—Å–∫–æ–π –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏

```yaml
{
  "measures": [
    "HorizontalAnalysis.currentBalance",
    "HorizontalAnalysis.previousBalance",
    "HorizontalAnalysis.absoluteChange",
    "HorizontalAnalysis.percentChange"
  ],
  "dimensions": [
    "HorizontalAnalysis.companyName",
    "HorizontalAnalysis.accountCode"
  ],
  "filters": [
    {
      "member": "HorizontalAnalysis.periodDate",
      "operator": "equals",
      "values": ["2024-10-31"]
    },
    {
      "member": "HorizontalAnalysis.accountCode",
      "operator": "equals",
      "values": ["62.01"]  # –†–∞—Å—á–µ—Ç—ã —Å –ø–æ–∫—É–ø–∞—Ç–µ–ª—è–º–∏
    }
  ]
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–ö–æ–º–ø–∞–Ω–∏—è: –û–û–û '–ê–ª—å—Ñ–∞'
–°—á–µ—Ç: 62.01 (–†–∞—Å—á–µ—Ç—ã —Å –ø–æ–∫—É–ø–∞—Ç–µ–ª—è–º–∏)
–û–∫—Ç—è–±—Ä—å 2024: 5,200,000 —Ä—É–±.
–°–µ–Ω—Ç—è–±—Ä—å 2024: 4,500,000 —Ä—É–±.
–ò–∑–º–µ–Ω–µ–Ω–∏–µ: +700,000 —Ä—É–±. (+15.6%)
```

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –¥–ª—è AI:**
"–î–µ–±–∏—Ç–æ—Ä—Å–∫–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –≤—ã—Ä–æ—Å–ª–∞ –Ω–∞ 15.6%, —á—Ç–æ –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ 
—É–≤–µ–ª–∏—á–µ–Ω–∏–µ –æ–±—ä–µ–º–∞ –ø—Ä–æ–¥–∞–∂ –≤ –∫—Ä–µ–¥–∏—Ç –∏–ª–∏ —É—Ö—É–¥—à–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–Ω–æ–π –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π."

---

### 3.3. –ö–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è –≥—Ä—É–ø–ø—ã –∫–æ–º–ø–∞–Ω–∏–π

**–§–∞–π–ª:** `cube_schema_consolidation.yml`

**–õ–æ–≥–∏–∫–∞ —ç–ª–∏–º–∏–Ω–∞—Ü–∏–π:**
1. **–í–∑–∞–∏–º–Ω—ã–µ –æ—Å—Ç–∞—Ç–∫–∏** (AR/AP elimination)
   - –î–µ–±–∏—Ç–æ—Ä–∫–∞ –∫–æ–º–ø–∞–Ω–∏–∏ –ê = –ö—Ä–µ–¥–∏—Ç–æ—Ä–∫–∞ –∫–æ–º–ø–∞–Ω–∏–∏ –ë ‚Üí –ò—Å–∫–ª—é—á–∞–µ—Ç—Å—è

2. **–í–Ω—É—Ç—Ä–∏–≥—Ä—É–ø–ø–æ–≤–∞—è –≤—ã—Ä—É—á–∫–∞**
   - –ü—Ä–æ–¥–∞–∂–∏ –º–µ–∂–¥—É –∫–æ–º–ø–∞–Ω–∏—è–º–∏ –≥—Ä—É–ø–ø—ã ‚Üí –ò—Å–∫–ª—é—á–∞—é—Ç—Å—è

3. **–ö–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏**
   - –ü–æ—Å–ª–µ —ç–ª–∏–º–∏–Ω–∞—Ü–∏–π –æ—Å—Ç–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞–º–∏

**–ú–µ—Ç—Ä–∏–∫–∏:**
- `totalDebitBalance` - –°—É–º–º–∞ –≤—Å–µ—Ö –∫–æ–º–ø–∞–Ω–∏–π (–¥–æ —ç–ª–∏–º–∏–Ω–∞—Ü–∏–π)
- `intercompanyBalanceElim` - –≠–ª–∏–º–∏–Ω–∏—Ä—É–µ–º—ã–µ –æ—Å—Ç–∞—Ç–∫–∏
- `intercompanyRevenueElim` - –≠–ª–∏–º–∏–Ω–∏—Ä—É–µ–º–∞—è –≤—ã—Ä—É—á–∫–∞
- `consolidatedDebitBalance` - –ö–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫
- `consolidatedRevenue` - –ö–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Ä—É—á–∫–∞
- `eliminationRate` - –î–æ–ª—è –≤–Ω—É—Ç—Ä–∏–≥—Ä—É–ø–ø–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (%)

#### –ü—Ä–∏–º–µ—Ä: –ö–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Ä—É—á–∫–∞ —Ö–æ–ª–¥–∏–Ω–≥–∞

```yaml
{
  "measures": [
    "Consolidation.totalCreditTurnover",
    "Consolidation.intercompanyRevenueElim",
    "Consolidation.consolidatedRevenue",
    "Consolidation.eliminationRate"
  ],
  "dimensions": [
    "Consolidation.groupName"
  ],
  "filters": [{
    "member": "Consolidation.periodDate",
    "operator": "inDateRange",
    "values": ["2024-01-01", "2024-12-31"]
  }]
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–ì—Ä—É–ø–ø–∞: –•–æ–ª–¥–∏–Ω–≥ "–ê–ª—å—Ñ–∞"
–í—Å–µ–≥–æ –≤—ã—Ä—É—á–∫–∏ (—Å—É–º–º–∞ –∫–æ–º–ø–∞–Ω–∏–π): 150,000,000 —Ä—É–±.
–≠–ª–∏–º–∏–Ω–∞—Ü–∏—è (–≤–Ω—É—Ç—Ä–∏–≥—Ä—É–ø–ø–æ–≤—ã–µ –ø—Ä–æ–¥–∞–∂–∏): -35,000,000 —Ä—É–±. (23.3%)
–ö–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Ä—É—á–∫–∞: 115,000,000 —Ä—É–±.
```

---

### 3.4. –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑

**–§–∞–π–ª:** `cube_schema_consolidation.yml` (–∫—É–± VerticalAnalysis)

**–ú–µ—Ç—Ä–∏–∫–∏:**
- `netBalance` - –û—Å—Ç–∞—Ç–æ–∫ –ø–æ —Å—á–µ—Ç—É
- `totalAssets` - –í—Å–µ–≥–æ –∞–∫—Ç–∏–≤–æ–≤
- `shareOfAssets` - –î–æ–ª—è –≤ –∞–∫—Ç–∏–≤–∞—Ö (%)
- `shareOfLiabilities` - –î–æ–ª—è –≤ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞—Ö (%)
- `shareOfRevenue` - –î–æ–ª—è –≤ –≤—ã—Ä—É—á–∫–µ (%)

#### –ü—Ä–∏–º–µ—Ä: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∞–∫—Ç–∏–≤–æ–≤

```yaml
{
  "measures": [
    "VerticalAnalysis.netBalance",
    "VerticalAnalysis.shareOfAssets"
  ],
  "dimensions": [
    "VerticalAnalysis.companyName",
    "VerticalAnalysis.balanceMgmtGroup"
  ],
  "segments": ["VerticalAnalysis.materialItems"],  # –¢–æ–ª—å–∫–æ >5%
  "order": {
    "VerticalAnalysis.shareOfAssets": "desc"
  }
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–ö–æ–º–ø–∞–Ω–∏—è: –û–û–û '–ê–ª—å—Ñ–∞'
–î–∞—Ç–∞: 31.10.2024

–ê–ö–¢–ò–í–´:
- –í–Ω–µ–æ–±–æ—Ä–æ—Ç–Ω—ã–µ –∞–∫—Ç–∏–≤—ã:     20,000,000 —Ä—É–±. (40.0%)
- –ó–∞–ø–∞—Å—ã:                   12,000,000 —Ä—É–±. (24.0%)
- –î–µ–±–∏—Ç–æ—Ä—Å–∫–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å: 10,000,000 —Ä—É–±. (20.0%)
- –î–µ–Ω–µ–∂–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞:         8,000,000 —Ä—É–±. (16.0%)
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–í—Å–µ–≥–æ –∞–∫—Ç–∏–≤–æ–≤:              50,000,000 —Ä—É–±. (100%)
```

---

## 4. –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –§–∞–∑–∞ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (1 –Ω–µ–¥–µ–ª—è)

**–ó–∞–¥–∞—á–∏:**
1. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Cube.js
   ```bash
   npx cubejs-cli create finance-analytics -d postgres
   cd finance-analytics
   npm install
   ```

2. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
   ```javascript
   // cube.js
   module.exports = {
     driverFactory: ({ dataSource }) => {
       return {
         type: 'postgres',
         host: process.env.CUBEJS_DB_HOST,
         database: process.env.CUBEJS_DB_NAME,
         user: process.env.CUBEJS_DB_USER,
         password: process.env.CUBEJS_DB_PASS,
       };
     },
   };
   ```

3. ‚úÖ –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ YAML —Å—Ö–µ–º—ã
   ```bash
   cp cube_schema_*.yml schema/
   ```

4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
   ```bash
   npm run dev
   # –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:4000
   ```

---

### –§–∞–∑–∞ 2: –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (2-3 –¥–Ω—è)

**–ó–∞–¥–∞—á–∏:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∏–º–ø–æ—Ä—Ç–∞ –ü–ª–∞–Ω–∞ —Å—á–µ—Ç–æ–≤
2. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –û–°–í (2-3 –ø–µ—Ä–∏–æ–¥–∞)
3. –°—Ä–∞–≤–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã Cube —Å Excel-—Ä–∞—Å—á–µ—Ç–∞–º–∏

**–ß–µ–∫-–ª–∏—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**
- [ ] –í—Å–µ 416 —Å—á–µ—Ç–æ–≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –ò–µ—Ä–∞—Ä—Ö–∏—è —Å—á–µ—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç (parent_code)
- [ ] –ê–Ω–∞–ª–∏—Ç–∏–∫–∏ (—Å—É–±–∫–æ–Ω—Ç–æ) –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–≤—è–∑–∞–Ω—ã
- [ ] –ë–∞–ª–∞–Ω—Å–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –æ–∂–∏–¥–∞–Ω–∏—è–º
- [ ] –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å Excel (–ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å <1%)
- [ ] –ö–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ —ç–ª–∏–º–∏–Ω–∏—Ä—É–µ—Ç –≤–Ω—É—Ç—Ä–∏–≥—Ä—É–ø–ø–æ–≤—ã–µ –æ–±–æ—Ä–æ—Ç—ã

**–¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ —Ç–µ–∫—É—â–µ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
const result = await cubejsApi.load({
  measures: [
    'FinancialRatios.currentAssets',
    'FinancialRatios.currentLiabilities',
    'FinancialRatios.currentRatio'
  ],
  dimensions: ['FinancialRatios.companyName'],
  filters: [{
    member: 'FinancialRatios.periodDate',
    operator: 'equals',
    values: ['2024-10-31']
  }]
});

// –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–∏–∑ Excel):
// –û–±–æ—Ä–æ—Ç–Ω—ã–µ –∞–∫—Ç–∏–≤—ã: 10,000,000
// –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞: 5,400,000
// Current Ratio: 1.85

console.assert(
  Math.abs(result.data[0]['FinancialRatios.currentRatio'] - 1.85) < 0.01,
  'Current Ratio –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å Excel!'
);
```

---

### –§–∞–∑–∞ 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AI (1-2 –Ω–µ–¥–µ–ª–∏)

–°–º. —Ä–∞–∑–¥–µ–ª [5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AI-–∞–≥–µ–Ω—Ç–∞–º–∏](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-—Å-ai-–∞–≥–µ–Ω—Ç–∞–º–∏)

---

### –§–∞–∑–∞ 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å DataLens (3-5 –¥–Ω–µ–π)

–°–º. —Ä–∞–∑–¥–µ–ª [6. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å DataLens](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-—Å-datalens)

---

### –§–∞–∑–∞ 5: Production deployment (1 –Ω–µ–¥–µ–ª—è)

**–ó–∞–¥–∞—á–∏:**
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å production-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Cube
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Grafana + Prometheus)
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
4. –ü—Ä–æ–≤–µ—Å—Ç–∏ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
5. –°–æ–∑–¥–∞—Ç—å backup-—Å—Ç—Ä–∞—Ç–µ–≥–∏—é

**Production checklist:**
- [ ] HTTPS –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] Authentication –≤–∫–ª—é—á–µ–Ω
- [ ] Rate limiting –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] Pre-aggregations —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Alerts –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

---

## 5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AI-–∞–≥–µ–Ω—Ç–∞–º–∏

### 5.1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ AI-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           LLM (Claude Sonnet 4)                  ‚îÇ
‚îÇ                                                  ‚îÇ
‚îÇ  System Prompt:                                  ‚îÇ
‚îÇ  "–¢—ã —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫. –ò—Å–ø–æ–ª—å–∑—É–π Cube API..." ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
               ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ        LangChain Agent (Python)                  ‚îÇ
‚îÇ                                                  ‚îÇ
‚îÇ  Tools:                                          ‚îÇ
‚îÇ  - FinancialRatiosTool                          ‚îÇ
‚îÇ  - HorizontalAnalysisTool                       ‚îÇ
‚îÇ  - ConsolidationTool                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
               ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          Cube REST API                           ‚îÇ
‚îÇ  POST /cubejs-api/v1/load                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
               ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ        PostgreSQL Database                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 5.2. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è AI Tools

**–§–∞–π–ª:** `ai_tools.py`

```python
from langchain.tools import Tool
from langchain_anthropic import ChatAnthropic
from langchain.agents import initialize_agent, AgentType
import requests
import os

# Cube API configuration
CUBE_API_URL = os.getenv('CUBE_API_URL', 'http://localhost:4000/cubejs-api/v1')
CUBE_API_SECRET = os.getenv('CUBE_API_SECRET')

def query_cube(query: dict) -> dict:
    """–ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Cube API"""
    response = requests.post(
        f"{CUBE_API_URL}/load",
        json={"query": query},
        headers={
            "Authorization": f"Bearer {CUBE_API_SECRET}",
            "Content-Type": "application/json"
        }
    )
    response.raise_for_status()
    return response.json()

# ============================================================================
# TOOL 1: –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã
# ============================================================================

def financial_ratios_tool(params: str) -> str:
    """
    –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏.
    
    Args:
        params: JSON string —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
        {
            "company": "–Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ –∏–ª–∏ ALL",
            "period": "YYYY-MM-DD",
            "ratios": ["currentRatio", "roe", "ros", ...]
        }
    
    Returns:
        JSON string —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
    
    Examples:
        >>> financial_ratios_tool('{"company": "–û–û–û –ê–ª—å—Ñ–∞", "period": "2024-10-31", 
                                    "ratios": ["currentRatio", "roe"]}')
    """
    import json
    params_dict = json.loads(params)
    
    query = {
        "measures": [f"FinancialRatios.{r}" for r in params_dict['ratios']],
        "dimensions": ["FinancialRatios.companyName"],
        "filters": [{
            "member": "FinancialRatios.periodDate",
            "operator": "equals",
            "values": [params_dict['period']]
        }]
    }
    
    if params_dict['company'] != 'ALL':
        query['filters'].append({
            "member": "FinancialRatios.companyName",
            "operator": "equals",
            "values": [params_dict['company']]
        })
    
    result = query_cube(query)
    return json.dumps(result['data'], ensure_ascii=False, indent=2)

financial_ratios_tool_langchain = Tool(
    name="FinancialRatios",
    func=financial_ratios_tool,
    description="""
    –ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤.
    
    –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã:
    
    –õ–ò–ö–í–ò–î–ù–û–°–¢–¨:
    - currentRatio: –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ç–µ–∫—É—â–µ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ (–Ω–æ—Ä–º–∞: 1.5-2.5)
    - quickRatio: –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –±—ã—Å—Ç—Ä–æ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ (–Ω–æ—Ä–º–∞: 0.7-1.0)
    - cashRatio: –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∞–±—Å–æ–ª—é—Ç–Ω–æ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ (–Ω–æ—Ä–º–∞: 0.2-0.3)
    
    –†–ï–ù–¢–ê–ë–ï–õ–¨–ù–û–°–¢–¨:
    - roa: –†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –∞–∫—Ç–∏–≤–æ–≤ (Return on Assets, %)
    - roe: –†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –∫–∞–ø–∏—Ç–∞–ª–∞ (Return on Equity, %)
    - ros: –†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–¥–∞–∂ (Return on Sales, %)
    - grossMargin: –í–∞–ª–æ–≤–∞—è —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å (%)
    
    –û–ë–û–†–ê–ß–ò–í–ê–ï–ú–û–°–¢–¨:
    - dso: –ü–µ—Ä–∏–æ–¥ –æ–±–æ—Ä–æ—Ç–∞ –¥–µ–±–∏—Ç–æ—Ä—Å–∫–æ–π –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏ (–¥–Ω–∏)
    - daysInventoryOutstanding: –ü–µ—Ä–∏–æ–¥ –æ–±–æ—Ä–æ—Ç–∞ –∑–∞–ø–∞—Å–æ–≤ (–¥–Ω–∏)
    - dpo: –ü–µ—Ä–∏–æ–¥ –æ–±–æ—Ä–æ—Ç–∞ –∫—Ä–µ–¥–∏—Ç–æ—Ä—Å–∫–æ–π –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏ (–¥–Ω–∏)
    - cashConversionCycle: –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ü–∏–∫–ª (–¥–Ω–∏)
    
    –§–ò–ù–ê–ù–°–û–í–ê–Ø –£–°–¢–û–ô–ß–ò–í–û–°–¢–¨:
    - equityRatio: –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∞–≤—Ç–æ–Ω–æ–º–∏–∏ (%, –Ω–æ—Ä–º–∞: >50%)
    - debtToEquity: –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ä—ã—á–∞–≥ (–Ω–æ—Ä–º–∞: <2.0)
    - debtRatio: –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏ (%, –Ω–æ—Ä–º–∞: <50%)
    
    Input: JSON —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ {"company": "...", "period": "...", "ratios": [...]}
    """
)

# ============================================================================
# TOOL 2: –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
# ============================================================================

def horizontal_analysis_tool(params: str) -> str:
    """
    –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –º–µ–∂–¥—É –¥–≤—É–º—è –ø–µ—Ä–∏–æ–¥–∞–º–∏.
    
    Args:
        params: JSON string —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
        {
            "company": "–Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏",
            "account": "–∫–æ–¥ —Å—á–µ—Ç–∞ –∏–ª–∏ ALL",
            "period": "YYYY-MM-DD",
            "metrics": ["absoluteChange", "percentChange", ...]
        }
    """
    import json
    params_dict = json.loads(params)
    
    query = {
        "measures": [f"HorizontalAnalysis.{m}" for m in params_dict['metrics']],
        "dimensions": [
            "HorizontalAnalysis.companyName",
            "HorizontalAnalysis.accountCode",
            "HorizontalAnalysis.accountName"
        ],
        "filters": [{
            "member": "HorizontalAnalysis.periodDate",
            "operator": "equals",
            "values": [params_dict['period']]
        }]
    }
    
    if params_dict['account'] != 'ALL':
        query['filters'].append({
            "member": "HorizontalAnalysis.accountCode",
            "operator": "equals",
            "values": [params_dict['account']]
        })
    
    result = query_cube(query)
    return json.dumps(result['data'], ensure_ascii=False, indent=2)

horizontal_analysis_tool_langchain = Tool(
    name="HorizontalAnalysis",
    func=horizontal_analysis_tool,
    description="""
    –ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∏–Ω–∞–º–∏–∫–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π (—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–æ–≤).
    
    –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
    - currentBalance: –¢–µ–∫—É—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫
    - previousBalance: –ü—Ä–µ–¥—ã–¥—É—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫
    - absoluteChange: –ê–±—Å–æ–ª—é—Ç–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ (–≤ —Ä—É–±–ª—è—Ö)
    - percentChange: –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ (%)
    - growthRate: –¢–µ–º–ø —Ä–æ—Å—Ç–∞ (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç)
    
    –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
    - "–ö–∞–∫ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å –¥–µ–±–∏—Ç–æ—Ä—Å–∫–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å?" ‚Üí account="62.01"
    - "–î–∏–Ω–∞–º–∏–∫–∞ –¥–µ–Ω–µ–∂–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤" ‚Üí account="50", "51"
    - "–ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–æ–≤" ‚Üí account="ALL"
    
    Input: JSON —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ {"company": "...", "account": "...", "period": "...", "metrics": [...]}
    """
)

# ============================================================================
# TOOL 3: –ö–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è
# ============================================================================

def consolidation_tool(params: str) -> str:
    """
    –ü–æ–ª—É—á–∞–µ—Ç –∫–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã –∫–æ–º–ø–∞–Ω–∏–π.
    
    Args:
        params: JSON string —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
        {
            "group": "–Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã",
            "period_from": "YYYY-MM-DD",
            "period_to": "YYYY-MM-DD",
            "metrics": ["consolidatedRevenue", ...]
        }
    """
    import json
    params_dict = json.loads(params)
    
    query = {
        "measures": [f"Consolidation.{m}" for m in params_dict['metrics']],
        "dimensions": [
            "Consolidation.groupName",
            "Consolidation.balanceMgmtGroup"
        ],
        "timeDimensions": [{
            "dimension": "Consolidation.periodDate",
            "dateRange": [params_dict['period_from'], params_dict['period_to']]
        }]
    }
    
    if params_dict.get('group') != 'ALL':
        query['filters'] = [{
            "member": "Consolidation.groupName",
            "operator": "equals",
            "values": [params_dict['group']]
        }]
    
    result = query_cube(query)
    return json.dumps(result['data'], ensure_ascii=False, indent=2)

consolidation_tool_langchain = Tool(
    name="Consolidation",
    func=consolidation_tool,
    description="""
    –ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏ –≥—Ä—É–ø–ø—ã –∫–æ–º–ø–∞–Ω–∏–π.
    
    –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
    - consolidatedRevenue: –ö–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Ä—É—á–∫–∞ (–±–µ–∑ –≤–Ω—É—Ç—Ä–∏–≥—Ä—É–ø–ø–æ–≤—ã—Ö –ø—Ä–æ–¥–∞–∂)
    - consolidatedDebitBalance: –ö–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–∫—Ç–∏–≤—ã
    - consolidatedCreditBalance: –ö–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞
    - intercompanyRevenueElim: –≠–ª–∏–º–∏–Ω–∏—Ä—É–µ–º–∞—è –≤—ã—Ä—É—á–∫–∞ (–≤–Ω—É—Ç—Ä–∏–≥—Ä—É–ø–ø–æ–≤—ã–µ –ø—Ä–æ–¥–∞–∂–∏)
    - eliminationRate: –î–æ–ª—è –≤–Ω—É—Ç—Ä–∏–≥—Ä—É–ø–ø–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (%)
    
    –ö–ª—é—á–µ–≤–æ–µ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –ø—Ä–æ—Å—Ç–æ–π —Å—É–º–º—ã:
    - –ò—Å–∫–ª—é—á–∞—é—Ç—Å—è –ø—Ä–æ–¥–∞–∂–∏ –º–µ–∂–¥—É –∫–æ–º–ø–∞–Ω–∏—è–º–∏ –≥—Ä—É–ø–ø—ã
    - –ò—Å–∫–ª—é—á–∞—é—Ç—Å—è –≤–∑–∞–∏–º–Ω—ã–µ –¥–æ–ª–≥–∏ –∫–æ–º–ø–∞–Ω–∏–π –≥—Ä—É–ø–ø—ã
    - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç "—á–∏—Å—Ç—É—é" –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ö–æ–ª–¥–∏–Ω–≥–∞
    
    Input: JSON —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ {"group": "...", "period_from": "...", "period_to": "...", "metrics": [...]}
    """
)

# ============================================================================
# –°–û–ó–î–ê–ù–ò–ï –ê–ì–ï–ù–¢–ê
# ============================================================================

def create_financial_analyst_agent():
    """–°–æ–∑–¥–∞–µ—Ç AI-–∞–≥–µ–Ω—Ç–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞"""
    
    llm = ChatAnthropic(
        model="claude-sonnet-4-20250514",
        temperature=0,  # –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤
    )
    
    tools = [
        financial_ratios_tool_langchain,
        horizontal_analysis_tool_langchain,
        consolidation_tool_langchain
    ]
    
    system_prompt = """
    –¢—ã –æ–ø—ã—Ç–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫ —Å –≥–ª—É–±–æ–∫–∏–º–∏ –∑–Ω–∞–Ω–∏—è–º–∏ —Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ –±—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–æ–≥–æ —É—á–µ—Ç–∞ (–†–°–ë–£).
    
    –¢–≤–æ–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–∞—é—Ç –¥–æ—Å—Ç—É–ø –∫ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –¥–∞–Ω–Ω—ã–º —á–µ—Ä–µ–∑ Cube API:
    1. FinancialRatios - —Ä–∞—Å—á–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏, —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏, –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏
    2. HorizontalAnalysis - –∞–Ω–∞–ª–∏–∑ –¥–∏–Ω–∞–º–∏–∫–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –º–µ–∂–¥—É –ø–µ—Ä–∏–æ–¥–∞–º–∏
    3. Consolidation - –∫–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å –≥—Ä—É–ø–ø—ã –∫–æ–º–ø–∞–Ω–∏–π
    
    –í–ê–ñ–ù–´–ï –ü–†–ê–í–ò–õ–ê:
    1. –í—Å–µ–≥–¥–∞ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–π —Ü–∏—Ñ—Ä—ã - –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–π –¥–∞–Ω–Ω—ã–µ, –æ–±—ä—è—Å–Ω—è–π —á—Ç–æ –æ–Ω–∏ –∑–Ω–∞—á–∞—Ç
    2. –°—Ä–∞–≤–Ω–∏–≤–∞–π —Å –Ω–æ—Ä–º–∞—Ç–∏–≤–∞–º–∏ –∏ –æ—Ç—Ä–∞—Å–ª–µ–≤—ã–º–∏ –±–µ–Ω—á–º–∞—Ä–∫–∞–º–∏
    3. –î–∞–≤–∞–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞
    4. –ï—Å–ª–∏ –≤–∏–¥–∏—à—å —Ç—Ä–µ–≤–æ–∂–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∂–∏ –Ω–∞ –Ω–∏—Ö
    5. –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —á–∏—Å–ª–∞ –∏–∑ API, –Ω–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π –¥–∞–Ω–Ω—ã–µ
    
    –ù–û–†–ú–ê–¢–ò–í–ù–´–ï –ó–ù–ê–ß–ï–ù–ò–Ø (–†–°–ë–£):
    - –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ç–µ–∫—É—â–µ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏: 1.5 - 2.5
    - –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –±—ã—Å—Ç—Ä–æ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏: 0.7 - 1.0
    - –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∞–≤—Ç–æ–Ω–æ–º–∏–∏: > 50%
    - ROE: > 10-15%
    - –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ä—ã—á–∞–≥: < 2.0
    
    –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤:
    1. –ö—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥ (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
    2. –ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —Å –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–µ–π
    3. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
    """
    
    agent = initialize_agent(
        tools=tools,
        llm=llm,
        agent=AgentType.OPENAI_FUNCTIONS,
        verbose=True,
        agent_kwargs={"system_message": system_prompt}
    )
    
    return agent

# ============================================================================
# –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø
# ============================================================================

if __name__ == "__main__":
    agent = create_financial_analyst_agent()
    
    # –ü—Ä–∏–º–µ—Ä 1: –ê–Ω–∞–ª–∏–∑ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
    response1 = agent.invoke(
        "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å –û–û–û '–ê–ª—å—Ñ–∞' –Ω–∞ 31 –æ–∫—Ç—è–±—Ä—è 2024. "
        "–ï—Å—Ç—å –ª–∏ —Ä–∏—Å–∫–∏ –Ω–µ–ø–ª–∞—Ç–µ–∂–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏?"
    )
    print(response1)
    
    # –ü—Ä–∏–º–µ—Ä 2: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–æ–≤
    response2 = agent.invoke(
        "–ö–∞–∫ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å –¥–µ–±–∏—Ç–æ—Ä—Å–∫–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –û–û–û '–ê–ª—å—Ñ–∞' "
        "–≤ –æ–∫—Ç—è–±—Ä–µ 2024 –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å —Å–µ–Ω—Ç—è–±—Ä–µ–º? –ß—Ç–æ —ç—Ç–æ –º–æ–∂–µ—Ç –æ–∑–Ω–∞—á–∞—Ç—å?"
    )
    print(response2)
    
    # –ü—Ä–∏–º–µ—Ä 3: –ö–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è –≥—Ä—É–ø–ø—ã
    response3 = agent.invoke(
        "–ö–∞–∫–∞—è –∫–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Ä—É—á–∫–∞ —Ö–æ–ª–¥–∏–Ω–≥–∞ '–ê–ª—å—Ñ–∞' –∑–∞ 9 –º–µ—Å—è—Ü–µ–≤ 2024? "
        "–ö–∞–∫–æ–π –ø—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ –≤–Ω—É—Ç—Ä–∏–≥—Ä—É–ø–ø–æ–≤—ã–µ –ø—Ä–æ–¥–∞–∂–∏?"
    )
    print(response3)
```

### 5.3. –ü—Ä–∏–º–µ—Ä –¥–∏–∞–ª–æ–≥–∞ —Å AI-–∞–≥–µ–Ω—Ç–æ–º

```
USER: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –û–û–û "–ê–ª—å—Ñ–∞" –Ω–∞ 31.10.2024

AI AGENT:
[–í—ã–∑—ã–≤–∞–µ—Ç FinancialRatios —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏...]

–ê–ù–ê–õ–ò–ó –§–ò–ù–ê–ù–°–û–í–û–ì–û –°–û–°–¢–û–Ø–ù–ò–Ø –û–û–û "–ê–õ–¨–§–ê"
–ü–µ—Ä–∏–æ–¥: 31 –æ–∫—Ç—è–±—Ä—è 2024

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üìä –ö–†–ê–¢–ö–ò–ô –í–´–í–û–î:
–ö–æ–º–ø–∞–Ω–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —É—Å—Ç–æ–π—á–∏–≤–æ–º —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–º –ø–æ–ª–æ–∂–µ–Ω–∏–∏ —Å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º–∏ 
–ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º–∏ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –∏ —É–º–µ—Ä–µ–Ω–Ω–æ–π —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å—é. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞–ø–∏—Ç–∞–ª–∞ 
—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∞, –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å –∞–∫—Ç–∏–≤–æ–≤ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –Ω–æ—Ä–º—ã.

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üíß –õ–ò–ö–í–ò–î–ù–û–°–¢–¨:
‚úÖ –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ç–µ–∫—É—â–µ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏: 1.85 (–Ω–æ—Ä–º–∞: 1.5-2.5)
   ‚Üí –ö–æ–º–ø–∞–Ω–∏—è —Å–ø–æ—Å–æ–±–Ω–∞ –ø–æ–∫—Ä—ã—Ç—å –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞

‚úÖ –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –±—ã—Å—Ç—Ä–æ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏: 0.92 (–Ω–æ—Ä–º–∞: 0.7-1.0)
   ‚Üí –•–æ—Ä–æ—à–∞—è –ø–ª–∞—Ç–µ–∂–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –¥–∞–∂–µ –±–µ–∑ –ø—Ä–æ–¥–∞–∂–∏ –∑–∞–ø–∞—Å–æ–≤

‚úÖ –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∞–±—Å–æ–ª—é—Ç–Ω–æ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏: 0.35 (–Ω–æ—Ä–º–∞: 0.2-0.3)
   ‚Üí –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–∂–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è —Å—Ä–æ—á–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üí∞ –†–ï–ù–¢–ê–ë–ï–õ–¨–ù–û–°–¢–¨:
‚ö†Ô∏è  ROE (—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –∫–∞–ø–∏—Ç–∞–ª–∞): 8.5% (–Ω–æ—Ä–º–∞: >10-15%)
   ‚Üí –ù–∏–∂–µ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è, —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è 
     —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∫–∞–ø–∏—Ç–∞–ª–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–ª—É—á—à–µ–Ω–∞

‚úÖ ROA (—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –∞–∫—Ç–∏–≤–æ–≤): 5.2%
   ‚Üí –ü—Ä–∏–µ–º–ª–µ–º—ã–π —É—Ä–æ–≤–µ–Ω—å –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏

‚úÖ ROS (—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–¥–∞–∂): 7.8%
   ‚Üí –ù–æ—Ä–º–∞–ª—å–Ω–∞—è –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Å–µ–∫—Ç–æ—Ä–∞

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üîÑ –û–ë–û–†–ê–ß–ò–í–ê–ï–ú–û–°–¢–¨:
‚úÖ –ü–µ—Ä–∏–æ–¥ –æ–±–æ—Ä–æ—Ç–∞ –î–ó (DSO): 45 –¥–Ω–µ–π
   ‚Üí –ö–ª–∏–µ–Ω—Ç—ã –ø–ª–∞—Ç—è—Ç –≤ —Å—Ä–µ–¥–Ω–µ–º —á–µ—Ä–µ–∑ 1.5 –º–µ—Å—è—Ü–∞ - –ø—Ä–∏–µ–º–ª–µ–º–æ

‚ö†Ô∏è  –ü–µ—Ä–∏–æ–¥ –æ–±–æ—Ä–æ—Ç–∞ –∑–∞–ø–∞—Å–æ–≤: 72 –¥–Ω—è
   ‚Üí –ó–∞–ø–∞—Å—ã –æ–±–æ—Ä–∞—á–∏–≤–∞—é—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω–µ–µ —Å—Ä–µ–¥–Ω–µ–≥–æ, –≤–æ–∑–º–æ–∂–Ω—ã –∏–∑–ª–∏—à–∫–∏

‚úÖ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ü–∏–∫–ª (CCC): 38 –¥–Ω–µ–π
   ‚Üí –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±–æ—Ä–æ—Ç–Ω—ã–º –∫–∞–ø–∏—Ç–∞–ª–æ–º

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üè¶ –§–ò–ù–ê–ù–°–û–í–ê–Ø –£–°–¢–û–ô–ß–ò–í–û–°–¢–¨:
‚úÖ –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∞–≤—Ç–æ–Ω–æ–º–∏–∏: 52.3% (–Ω–æ—Ä–º–∞: >50%)
   ‚Üí –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ–±–µ—Å–ø–µ—á–µ–Ω–∞

‚úÖ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ä—ã—á–∞–≥ (Debt-to-Equity): 0.91 (–Ω–æ—Ä–º–∞: <2.0)
   ‚Üí –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞–ø–∏—Ç–∞–ª–∞, –Ω–∏–∑–∫–∞—è –¥–æ–ª–≥–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:

1. –°–†–û–ß–ù–û (0-1 –º–µ—Å—è—Ü):
   ‚Ä¢ –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º, —Ç—Ä–µ–±—É—é—â–∏—Ö –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞

2. –í–ê–ñ–ù–û (1-3 –º–µ—Å—è—Ü–∞):
   ‚Ä¢ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∞—Å–∞–º–∏ (72 –¥–Ω—è ‚Üí —Ü–µ–ª–µ–≤–æ–π: 45-60 –¥–Ω–µ–π)
   ‚Ä¢ –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏—á–∏–Ω—ã —Å–Ω–∏–∂–µ–Ω–∏—è ROE (<10%)

3. –°–¢–†–ê–¢–ï–ì–ò–ß–ï–°–ö–ò (3-6 –º–µ—Å—è—Ü–µ–≤):
   ‚Ä¢ –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–≤—ã—à–µ–Ω–∏—è —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–¥–∞–∂
   ‚Ä¢ –û—Ü–µ–Ω–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤–Ω–µ–æ–±–æ—Ä–æ—Ç–Ω—ã—Ö –∞–∫—Ç–∏–≤–æ–≤
```

---

## 6. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å DataLens

### 6.1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ DataLens –∫ Cube

**–°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ SQL API Cube**

Cube –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç PostgreSQL-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π SQL –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:

```yaml
# cube.js - –≤–∫–ª—é—á–∏—Ç—å SQL API
module.exports = {
  // ...
  sql: {
    port: 5432,  // Postgres-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π –ø–æ—Ä—Ç
  },
};
```

–í DataLens:
1. –°–æ–∑–¥–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ ‚Üí PostgreSQL
2. Host: `cube-host.com`
3. Port: `5432`
4. Database: `db`
5. User/Password: –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Cube

**–°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ REST API (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä DataLens –¥–ª—è REST API:

```javascript
// –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä –¥–ª—è DataLens
const express = require('express');
const axios = require('axios');

const app = express();

app.get('/api/datalens/ratios', async (req, res) => {
  const result = await axios.post('http://cube:4000/cubejs-api/v1/load', {
    query: {
      measures: req.query.measures.split(','),
      dimensions: req.query.dimensions.split(','),
      filters: JSON.parse(req.query.filters || '[]')
    }
  });
  
  res.json(result.data);
});

app.listen(3000);
```

### 6.2. –ü—Ä–∏–º–µ—Ä—ã –¥–∞—à–±–æ—Ä–¥–æ–≤ –≤ DataLens

**–î–∞—à–±–æ—Ä–¥ 1: –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã**

```sql
-- –í DataLens —Å–æ–∑–¥–∞—Ç—å dataset —Å –∑–∞–ø—Ä–æ—Å–æ–º –∫ Cube SQL API

SELECT 
    company_name,
    period_date,
    current_ratio,
    quick_ratio,
    roe,
    ros,
    debt_to_equity
FROM FinancialRatios
WHERE period_date >= '2024-01-01'
ORDER BY period_date DESC;
```

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏:**
- Line chart: –î–∏–Ω–∞–º–∏–∫–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –≤–æ –≤—Ä–µ–º–µ–Ω–∏
- Indicator: –¢–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å —Ü–≤–µ—Ç–æ–≤–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–µ–π (–∫—Ä–∞—Å–Ω—ã–π <–ø–æ—Ä–æ–≥, –∑–µ–ª–µ–Ω—ã–π >–ø–æ—Ä–æ–≥)
- Table: –î–µ—Ç–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –≤—Å–µ—Ö –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤

**–î–∞—à–±–æ—Ä–¥ 2: –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑**

```sql
SELECT 
    account_code,
    account_name,
    current_balance,
    previous_balance,
    absolute_change,
    percent_change
FROM HorizontalAnalysis
WHERE period_date = [Parameter: period_date]
  AND ABS(percent_change) > 10  -- –¢–æ–ª—å–∫–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
ORDER BY ABS(percent_change) DESC;
```

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏:**
- Bar chart: Top 10 —Å—á–µ—Ç–æ–≤ —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
- Waterfall chart: –í–∫–ª–∞–¥ –∫–∞–∂–¥–æ–≥–æ —Å—á–µ—Ç–∞ –≤ –æ–±—â–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–æ–≤
- Heatmap: –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º –∏ —Å—á–µ—Ç–∞–º

**–î–∞—à–±–æ—Ä–¥ 3: –ö–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è –≥—Ä—É–ø–ø—ã**

```sql
SELECT 
    group_name,
    period_date,
    total_credit_turnover as gross_revenue,
    intercompany_revenue_elim as intercompany_sales,
    consolidated_revenue as net_revenue,
    elimination_rate
FROM Consolidation
WHERE period_date >= '2024-01-01'
ORDER BY period_date;
```

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏:**
- Stacked bar chart: –í—ã—Ä—É—á–∫–∞ –¥–æ –∏ –ø–æ—Å–ª–µ —ç–ª–∏–º–∏–Ω–∞—Ü–∏–π
- Gauge: –î–æ–ª—è –≤–Ω—É—Ç—Ä–∏–≥—Ä—É–ø–ø–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- Line chart: –¢—Ä–µ–Ω–¥ –∫–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤—ã—Ä—É—á–∫–∏

---

## 7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

### 7.1. Unit-—Ç–µ—Å—Ç—ã –¥–ª—è Cube –º–µ—Ä

```javascript
// tests/financial_ratios.test.js

const CubeApi = require('@cubejs-client/core');

describe('Financial Ratios Tests', () => {
  let cubejsApi;
  
  beforeAll(() => {
    cubejsApi = CubeApi.cubejsApi({
      apiUrl: 'http://localhost:4000/cubejs-api/v1',
      apiToken: process.env.CUBEJS_API_SECRET
    });
  });
  
  test('Current Ratio should match Excel calculation', async () => {
    const result = await cubejsApi.load({
      measures: [
        'FinancialRatios.currentAssets',
        'FinancialRatios.currentLiabilities',
        'FinancialRatios.currentRatio'
      ],
      filters: [{
        member: 'FinancialRatios.companyName',
        operator: 'equals',
        values: ['–û–û–û "–¢–µ—Å—Ç"']
      }, {
        member: 'FinancialRatios.periodDate',
        operator: 'equals',
        values: ['2024-10-31']
      }]
    });
    
    const data = result.data[0];
    
    // –û–∂–∏–¥–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ Excel
    expect(data['FinancialRatios.currentAssets']).toBe(10000000);
    expect(data['FinancialRatios.currentLiabilities']).toBe(5400000);
    expect(data['FinancialRatios.currentRatio']).toBeCloseTo(1.85, 2);
  });
  
  test('ROE calculation should be correct', async () => {
    const result = await cubejsApi.load({
      measures: [
        'FinancialRatios.netProfit',
        'FinancialRatios.equity',
        'FinancialRatios.roe'
      ],
      filters: [{
        member: 'FinancialRatios.companyName',
        operator: 'equals',
        values: ['–û–û–û "–¢–µ—Å—Ç"']
      }, {
        member: 'FinancialRatios.periodDate',
        operator: 'equals',
        values: ['2024-10-31']
      }]
    });
    
    const data = result.data[0];
    const expectedROE = (data['FinancialRatios.netProfit'] / 
                         data['FinancialRatios.equity']) * 100;
    
    expect(data['FinancialRatios.roe']).toBeCloseTo(expectedROE, 1);
  });
});
```

### 7.2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

```python
# tests/test_integration.py

import pytest
import requests
import pandas as pd

CUBE_API_URL = "http://localhost:4000/cubejs-api/v1"

def test_end_to_end_financial_analysis():
    """
    –¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –∞–Ω–∞–ª–∏–∑–∞:
    1. –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –û–°–í
    2. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã —á–µ—Ä–µ–∑ Cube
    3. –°—Ä–∞–≤–Ω–∏—Ç—å —Å —ç—Ç–∞–ª–æ–Ω–Ω—ã–º Excel-—Ñ–∞–π–ª–æ–º
    """
    
    # 1. –ó–∞–≥—Ä—É–∑–∏—Ç—å —ç—Ç–∞–ª–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    excel_data = pd.read_excel('tests/data/test_ratios_expected.xlsx')
    
    # 2. –ó–∞–ø—Ä–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ Cube API
    query = {
        "measures": [
            "FinancialRatios.currentRatio",
            "FinancialRatios.roe",
            "FinancialRatios.dso"
        ],
        "dimensions": ["FinancialRatios.companyName"],
        "filters": [{
            "member": "FinancialRatios.periodDate",
            "operator": "equals",
            "values": ["2024-10-31"]
        }]
    }
    
    response = requests.post(
        f"{CUBE_API_URL}/load",
        json={"query": query}
    )
    cube_data = pd.DataFrame(response.json()['data'])
    
    # 3. –°—Ä–∞–≤–Ω–∏—Ç—å
    for index, row in excel_data.iterrows():
        company = row['company_name']
        cube_row = cube_data[cube_data['FinancialRatios.companyName'] == company].iloc[0]
        
        assert abs(cube_row['FinancialRatios.currentRatio'] - row['current_ratio']) < 0.01
        assert abs(cube_row['FinancialRatios.roe'] - row['roe']) < 0.1
        assert abs(cube_row['FinancialRatios.dso'] - row['dso']) < 1.0

def test_consolidation_eliminations():
    """–¢–µ—Å—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —ç–ª–∏–º–∏–Ω–∞—Ü–∏–π"""
    
    query = {
        "measures": [
            "Consolidation.totalCreditTurnover",
            "Consolidation.intercompanyRevenueElim",
            "Consolidation.consolidatedRevenue"
        ],
        "dimensions": ["Consolidation.groupName"],
        "filters": [{
            "member": "Consolidation.periodDate",
            "operator": "equals",
            "values": ["2024-10-31"]
        }]
    }
    
    response = requests.post(f"{CUBE_API_URL}/load", json={"query": query})
    data = response.json()['data'][0]
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞: –∫–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Ä—É—á–∫–∞ = –æ–±—â–∞—è - —ç–ª–∏–º–∏–Ω–∞—Ü–∏–∏
    expected_consolidated = (
        data['Consolidation.totalCreditTurnover'] - 
        data['Consolidation.intercompanyRevenueElim']
    )
    
    assert abs(data['Consolidation.consolidatedRevenue'] - expected_consolidated) < 100
```

### 7.3. –í–∞–ª–∏–¥–∞—Ü–∏—è AI-–æ—Ç–≤–µ—Ç–æ–≤

```python
# tests/test_ai_validation.py

def test_ai_ratio_interpretation():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ AI –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã"""
    
    agent = create_financial_analyst_agent()
    
    # –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–∏–∑–∫–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å
    response = agent.invoke(
        "–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ç–µ–∫—É—â–µ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ = 0.8. –ß—Ç–æ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç?"
    )
    
    assert "—Ä–∏—Å–∫" in response.lower() or "–ø—Ä–æ–±–ª–µ–º" in response.lower()
    assert "–Ω–µ–ø–ª–∞—Ç–µ–∂–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç" in response.lower()
    
    # –°—Ü–µ–Ω–∞—Ä–∏–π 2: –í—ã—Å–æ–∫–∞—è —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å
    response = agent.invoke(
        "ROE = 25%. –≠—Ç–æ —Ö–æ—Ä–æ—à–æ –∏–ª–∏ –ø–ª–æ—Ö–æ?"
    )
    
    assert "—Ö–æ—Ä–æ—à" in response.lower() or "–≤—ã—Å–æ–∫" in response.lower()
    
    # –°—Ü–µ–Ω–∞—Ä–∏–π 3: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –Ω–æ—Ä–º–∞—Ç–∏–≤–∞–º–∏
    response = agent.invoke(
        "–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∞–≤—Ç–æ–Ω–æ–º–∏–∏ = 35%. –ö–∞–∫–æ–π –Ω–æ—Ä–º–∞—Ç–∏–≤?"
    )
    
    assert "50" in response or "–Ω–æ—Ä–º" in response.lower()
```

---

## 8. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### 8.1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Pre-Aggregations

Pre-aggregations - —ç—Ç–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ Cube 
–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤.

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è –≤–∞—à–µ–≥–æ –∫–µ–π—Å–∞:**

```yaml
# –í –∫–∞–∂–¥–æ–º cube –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã pre-aggregations

preAggregations:
  # –î–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ AI-–∞–≥–µ–Ω—Ç–æ–≤
  - name: ratiosByCompanyMonth
    measures:
      - currentRatio
      - roe
      - ros
    dimensions:
      - companyName
      - periodDate
    timeDimension: periodDate
    granularity: month
    refreshKey:
      every: 2 hours  # –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞
    partitionGranularity: month  # –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –º–µ—Å—è—Ü–∞–º
    
  # –î–ª—è DataLens –¥–∞—à–±–æ—Ä–¥–æ–≤
  - name: detailedBalances
    measures:
      - closingDebitBalance
      - closingCreditBalance
    dimensions:
      - companyName
      - accountCode
      - periodDate
    timeDimension: periodDate
    granularity: day
    refreshKey:
      every: 1 hour  # –ë–æ–ª–µ–µ —á–∞—Å—Ç–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è –¥–∞—à–±–æ—Ä–¥–æ–≤
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –°–æ–∑–¥–∞–≤–∞–π—Ç–µ pre-aggregations –¥–ª—è –¢–û–ü-10 —Å–∞–º—ã—Ö —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `partitionGranularity` –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `refreshKey` –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏

### 8.2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:**

```javascript
// Prometheus metrics –¥–ª—è Cube
{
  cube_query_duration_seconds: 0.34,  // –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
  cube_pre_aggregation_hit_rate: 0.85,  // –ü–æ–ø–∞–¥–∞–Ω–∏–µ –≤ –∫—ç—à
  cube_sql_queries_total: 1523,  // –í—Å–µ–≥–æ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤
  cube_memory_usage_bytes: 524288000  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
}
```

**Alerts:**
- Query duration > 5 sec ‚Üí –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å pre-aggregation
- Hit rate < 70% ‚Üí –ü–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é pre-aggregations
- Memory > 80% ‚Üí –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ

### 8.3. –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ >1000 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–ª–∞—Å—Ç–µ—Ä Cube:

```yaml
# docker-compose.yml
version: '3'
services:
  cube-api-1:
    image: cubejs/cube:latest
    environment:
      - CUBEJS_DB_TYPE=postgres
      - CUBEJS_REDIS_URL=redis://redis:6379
    deploy:
      replicas: 3  # 3 API-–∏–Ω—Å—Ç–∞–Ω—Å–∞
  
  cube-refresh-worker:
    image: cubejs/cube:latest
    environment:
      - CUBEJS_REFRESH_WORKER=true  # –û—Ç–¥–µ–ª—å–Ω—ã–π –≤–æ—Ä–∫–µ—Ä –¥–ª—è refresh
    deploy:
      replicas: 2
  
  redis:
    image: redis:latest  # –û–±—â–∏–π –∫—ç—à –¥–ª—è –≤—Å–µ—Ö –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤
  
  nginx:
    image: nginx:latest
    # Load balancer –¥–ª—è cube-api-*
```

---

## üìä –ò—Ç–æ–≥–æ–≤—ã–π —á–µ–∫-–ª–∏—Å—Ç –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –§–∞–∑–∞ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ ‚úÖ
- [ ] Cube —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –∑–∞–ø—É—â–µ–Ω
- [ ] PostgreSQL –ø–æ–¥–∫–ª—é—á–µ–Ω
- [ ] –í—Å–µ 4 YAML schema –∑–∞–≥—Ä—É–∂–µ–Ω—ã
- [ ] –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Å—á–µ—Ç–æ–≤ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω (416 —Å—á–µ—Ç–æ–≤)
- [ ] –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –û–°–í –∑–∞–≥—Ä—É–∂–µ–Ω—ã (–º–∏–Ω–∏–º—É–º 2 –ø–µ—Ä–∏–æ–¥–∞)

### –§–∞–∑–∞ 2: –í–∞–ª–∏–¥–∞—Ü–∏—è ‚úÖ
- [ ] –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å Excel (–ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å <1%)
- [ ] –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ö–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ —ç–ª–∏–º–∏–Ω–∏—Ä—É–µ—Ç –≤–Ω—É—Ç—Ä–∏–≥—Ä—É–ø–ø–æ–≤—ã–µ –æ–±–æ—Ä–æ—Ç—ã
- [ ] Unit-—Ç–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã –∏ –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

### –§–∞–∑–∞ 3: AI Integration ‚úÖ
- [ ] LangChain –∞–≥–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω
- [ ] 3 AI Tools —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã (Ratios, Horizontal, Consolidation)
- [ ] –ü—Ä–æ–º–ø—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è AI-–æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –§–∞–∑–∞ 4: DataLens Integration ‚úÖ
- [ ] DataLens –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ Cube SQL API
- [ ] 3 –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–∞—à–±–æ—Ä–¥–∞ —Å–æ–∑–¥–∞–Ω—ã
- [ ] –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –§–∏–ª—å—Ç—Ä—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] Performance –ø—Ä–∏–µ–º–ª–µ–º—ã–π (<2 —Å–µ–∫ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞)

### –§–∞–∑–∞ 5: Production ‚úÖ
- [ ] HTTPS –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] Authentication –≤–∫–ª—é—á–µ–Ω
- [ ] Pre-aggregations —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Grafana/Prometheus) —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Alerts –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] Backup-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] –ö–æ–º–∞–Ω–¥–∞ –æ–±—É—á–µ–Ω–∞

---

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—ã –ø–æ–ª—É—á–∏–ª–∏ –∫–æ–º–ø–ª–µ–∫—Å–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞, –∫–æ—Ç–æ—Ä–∞—è:

‚úÖ **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑—É–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É** - 20+ –º–µ—Ç–æ–¥–∏–∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –æ–¥–Ω–∞–∂–¥—ã
‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–æ—Å—Å–∏–π—Å–∫—É—é —Å–ø–µ—Ü–∏—Ñ–∏–∫—É** - 416 —Å—á–µ—Ç–æ–≤, –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
‚úÖ **–ì–æ—Ç–æ–≤–∞ –¥–ª—è AI** - REST API —Å –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –º–µ—Ä–∞–º–∏
‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å BI** - DataLens –≤–∏–¥–∏—Ç —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ –∏ AI
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è** - Pre-aggregations + horizontal scaling
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–∞** - Row-level security + –≤–∞–ª–∏–¥–∞—Ü–∏—è

**ROI:** 
- –ü–µ—Ä–≤–∏—á–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ: 5-6 –Ω–µ–¥–µ–ª—å
- Break-even: 3-4 –º–µ—Å—è—Ü–∞
- –ì–æ–¥–æ–≤–∞—è —ç–∫–æ–Ω–æ–º–∏—è: ~200 —á–∞—Å–æ–≤ –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É + —Å–Ω–∏–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –Ω–∞ 80%

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –ù–∞—á–Ω–∏—Ç–µ —Å –§–∞–∑—ã 1 (—É—Å—Ç–∞–Ω–æ–≤–∫–∞ Cube)
2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ schemas
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö 2-3 –∫–æ–º–ø–∞–Ω–∏–π
4. –†–∞—Å—à–∏—Ä—è–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ

–£–¥–∞—á–∏ –≤–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏–∏! üöÄ
